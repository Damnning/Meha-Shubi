# FastAPI Meha&Shubi

–ú–æ—â–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –º–∞–≥–∞–∑–∏–Ω–∞ "–ú–µ—Ö–∞ –∏ —à—É–±—ã"). –ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **FastAPI** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ **Clean Architecture**.

–í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å **S3** –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫, **LLM (AI)** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ **Telegram**.

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

*   **Language:** Python 3.10+
*   **Web Framework:** FastAPI
*   **Database:** PostgreSQL + SQLAlchemy 2.0 (Async)
*   **Infrastructure:** Docker & Docker Compose
*   **Storage:** MinIO (S3 compatible)
*   **Validation:** Pydantic v2
*   **AI Integration:** OpenRouter / OpenAI API
*   **Auth:** JWT + Telegram Login Widget

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ —Å–ª–æ–∏ (Clean Architecture):

```text
app/
‚îú‚îÄ‚îÄ api/            # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (Routers). –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤.
‚îú‚îÄ‚îÄ core/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env), –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT), –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OAuth.
‚îú‚îÄ‚îÄ db/             # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, —Å–µ—Å—Å–∏–∏.
‚îú‚îÄ‚îÄ models/         # SQLAlchemy –º–æ–¥–µ–ª–∏ (—Ç–∞–±–ª–∏—Ü—ã –ë–î).
‚îú‚îÄ‚îÄ schemas/        # Pydantic —Å—Ö–µ–º—ã (DTO) –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
‚îî‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞. –ó–¥–µ—Å—å –∂–∏–≤–µ—Ç –≤—Å—è –º–∞–≥–∏—è (CRUD, AI, S3, Auth).

docker-compose.yaml # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (App, DB, MinIO, Tunnel)
Dockerfile          # –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

## ‚ú® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üõí –ö–∞—Ç–∞–ª–æ–≥ –∏ –¢–æ–≤–∞—Ä—ã
*   **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:** –í–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª—é–±–æ–π –≥–ª—É–±–∏–Ω—ã (Tree structure). –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞.
*   **–¢–æ–≤–∞—Ä—ã:** CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, Soft Delete (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ).
*   **–ü–æ–∏—Å–∫:** –°–ª–æ–∂–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º (JSONB).
*   **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ S3 (MinIO), –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–æ–≤–∞—Ä—É.
*   **AI –û–ø–∏—Å–∞–Ω–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–∞—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (—á–µ—Ä–µ–∑ LLM).

### üõç –ö–æ—Ä–∑–∏–Ω–∞ –∏ –ó–∞–∫–∞–∑—ã
*   **–ö–æ—Ä–∑–∏–Ω–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.
*   **–ó–∞–∫–∞–∑—ã:** –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≤ –∑–∞–∫–∞–∑ —Å **—Ñ–∏–∫—Å–∞—Ü–∏–µ–π —Ü–µ–Ω—ã** (Snapshot) –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏.

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
*   **–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è:** Email + Password (JWT Access Token).
*   **Telegram:** –í—Ö–æ–¥ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫ —á–µ—Ä–µ–∑ Telegram Login Widget (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à-–ø–æ–¥–ø–∏—Å–∏).

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
git clone <repository_url>
cd <project_folder>
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∏–∂–µ.

**–ü—Ä–∏–º–µ—Ä `.env`:**

```ini
# --- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
# –ü—É–±–ª–∏—á–Ω—ã–π URL –≤–∞—à–µ–≥–æ API (–≤–∞–∂–Ω–æ –¥–ª—è Telegram –≤–∏–¥–∂–µ—Ç–∞). 
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare Tunnel, –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Å—é–¥–∞.
BASE_URL=https://your-tunnel-url.cloudpub.ru

# --- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ---
DB_USER=postgres
DB_PASS=postgres_password
DB_HOST=db
DB_PORT=5432
DB_NAME=shop_db

# --- S3 / MinIO (–•—Ä–∞–Ω–∏–ª–∏—â–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫) ---
S3_ACCESS_KEY=minio_admin
S3_SECRET_KEY=minio_password
S3_BUCKET_NAME=shop-images
S3_ENDPOINT_URL=http://minio:9000
S3_REGION=us-east-1

# --- LLM (OpenRouter / OpenAI) ---
OPENAI_KEY=sk-or-v1-......
LLM_MODEL=mistralai/mistral-7b-instruct:free

# --- Telegram Auth ---
# –¢–æ–∫–µ–Ω –æ—Ç @BotFather
TG_BOT_TOKEN=123456:AAHE.......

# --- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ---
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
SESSION_SECRET=random_session_secret_string
SECRET_KEY=random_jwt_secret_key
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (–ë—ç–∫–µ–Ω–¥, –ë–î, MinIO, Cloudflare Tunnel) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:  
üëâ **http://localhost:8000/docs** (–∏–ª–∏ –ø–æ –≤–∞—à–µ–º—É –ø—É–±–ª–∏—á–Ω–æ–º—É URL).

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Telegram Login
–¢–∞–∫ –∫–∞–∫ Telegram Widget —Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞, –¥–ª—è —Ç–µ—Å—Ç–∞ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `BASE_URL` –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∞—à–∏–º –ø—É–±–ª–∏—á–Ω—ã–º –¥–æ–º–µ–Ω–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Cloudpub/Ngrok).
2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `@BotFather` —É–∫–∞–∂–∏—Ç–µ —ç—Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω (–∫–æ–º–∞–Ω–¥–∞ `/setdomain`).
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://your-public-domain.ru/login_test`
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Log in as...". –í—ã –ø–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω.

### –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è (Flow)
1. **POST** `/api/v1/auth/register` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. **POST** `/api/v1/auth/login` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞.
3. **POST** `/api/v1/categories` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
4. **POST** `/api/v1/products/generate-description` ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —á–µ—Ä–µ–∑ AI.
5. **POST** `/api/v1/products` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.
6. **POST** `/api/v1/cart/add` ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É.
7. **POST** `/api/v1/orders` ‚Äî –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

*   **Pydantic v2:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `model_config` –∏ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è.
*   **Dependency Injection:** –°–µ—Å—Å–∏—è –ë–î (`get_db`) –∏ —Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä (`get_current_user`) –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `Depends`.
*   **SQLAlchemy Async:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `set_committed_value` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ (–¥–µ—Ä–µ–≤—å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π) –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
*   **Two-Step Upload:** –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞.